import{_ as F}from"./AppAutocomplete-BzYkBTH_.js";import{_ as q}from"./AppTextField-Br79e8N5.js";import{V as Y,_ as K}from"./VSnackbar-COoBM9sF.js";import{u as U}from"./useApi-D0I0y0wR.js";import{c as D}from"./createUrl-D7OVRdvr.js";import{$ as M}from"./api-DNNSXWSR.js";import{V as h,a as O,b as j}from"./VCard-BENoyoRF.js";import{E as G,r as n,w as I,f as x,c as H,l as t,e as r,b as o,a2 as J,F as W,a as X,o as f,ay as Z,s as m,d as S,a0 as ee,t as T,az as ae}from"./main-DlK_6brO.js";import{V as B}from"./VDivider-5xE2vq0T.js";import{V as A}from"./VCardText-XG_jfGL7.js";import{V as te}from"./VSpacer-mV90zFmL.js";import{V as le}from"./VDataTableServer-2ysyVdfJ.js";import{V as se}from"./VChip-CPE0xymr.js";import"./VTextField-ey2kkCh5.js";import"./VImg-DuZtXcXN.js";import"./forwardRefs-Boe-Kggg.js";import"./VList-BRN7CMEK.js";import"./VAvatar-Cv7RHaPM.js";import"./VMenu-BF0rrIB2.js";import"./index-CvOPxmL5.js";/* empty css              */import"./VDataTable-CzR2EuQ0.js";import"./VTable-DFDa3wzZ.js";const ie={class:"d-flex gap-2 align-center"},oe={class:"d-flex align-center flex-wrap gap-4"},re={class:"clamp-text text-white mb-0"},Be={__name:"pip",setup(pe){G(async()=>{await L()});const g=n(!1),v=n(),L=async()=>{var l;g.value=!0;try{let i=(await U(D("/cek-sekolah"))).data.value;v.value=i.sekolah,p.value.semester_id=(l=i.semester)==null?void 0:l.semester_id,v.value&&C()}catch(e){console.error(e)}finally{g.value=!1}},N=[{title:"Nama",key:"nama",sortable:!0,nowrap:!0},{title:"NISN",key:"nisn",align:"center"},{title:"Kelas",key:"kelas",align:"center",sortable:!1},{title:"Penerima PIP",key:"penerima_kip",align:"center",sortable:!1},{title:"Layak PIP",key:"layak_pip",align:"center",sortable:!1},{title:"Alasan Layak PIP",key:"id_layak_pip",align:"center",sortable:!1},{title:"aksi",key:"aksi",align:"center",sortable:!1}],s=n({page:1,itemsPerPage:10,searchQuery:"",selectedRole:null,sortby:"nama",sortbydesc:"ASC"}),V=n(!1),b=n([]),P=n(0),w=n([]),$=l=>{var e,i;s.value.sortby=(e=l[0])==null?void 0:e.key,s.value.sortbydesc=(i=l[0])==null?void 0:i.order},p=n({semester_id:null,layak_pip:{},id_layak_pip:{}}),_=n(!1),C=async()=>{V.value=!0;try{let e=(await U(D("/pip",{query:{q:s.value.searchQuery,page:s.value.page,per_page:s.value.itemsPerPage,sortby:s.value.sortby,sortbydesc:s.value.sortbydesc}}))).data.value;b.value=e.data.data,P.value=e.data.total,w.value=e.layak_pip,b.value.forEach(i=>{p.value.layak_pip[i.peserta_didik_id]=i.layak_pip,p.value.id_layak_pip[i.peserta_didik_id]=i.id_layak_pip?parseInt(i.id_layak_pip):null})}catch(l){console.error(l)}finally{V.value=!1}};I(s,ae(()=>{C()},500),{deep:!0}),I(()=>s.value.searchQuery,()=>{s.value.page=1});const c=n([]),z=n(),k=n({layak_pip:{},id_layak_pip:{}}),Q=async l=>{z.value=l,c.value[l]=!0,await M("/pip",{method:"POST",body:{peserta_didik_id:l,layak_pip:p.value.layak_pip[l],id_layak_pip:p.value.id_layak_pip[l]},async onResponse({response:e}){var u,y;console.log(p.value.layak_pip[l]);const i=e._data;c.value[l]=!1,k.value.layak_pip[l]=((u=i.errors)==null?void 0:u.layak_pip)??void 0,k.value.id_layak_pip[l]=((y=i.errors)==null?void 0:y.id_layak_pip)??void 0,i.errors||(_.value=!0)}})},R=(l,e)=>{parseInt(e)||(p.value.id_layak_pip[l]=null)};return(l,e)=>{const i=K,u=q,y=F,E=X("RouterLink");return t(g)?(f(),x(h,{key:0,class:"text-center"},{default:r(()=>[o(Z,{size:60,indeterminate:"",color:"error",class:"my-10"})]),_:1})):(f(),H(W,{key:1},[t(v)?(f(),x(h,{key:0},{default:r(()=>[o(O,{class:"pb-4"},{default:r(()=>[o(j,null,{default:r(()=>e[4]||(e[4]=[m("Data Periodik Siswa")])),_:1,__:[4]})]),_:1}),o(B),o(A,{class:"d-flex flex-wrap gap-4"},{default:r(()=>[S("div",ie,[o(i,{modelValue:t(s).itemsPerPage,"onUpdate:modelValue":e[0]||(e[0]=a=>t(s).itemsPerPage=a),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"}],style:{"inline-size":"15.5rem"}},null,8,["modelValue"])]),o(te),S("div",oe,[o(u,{modelValue:t(s).searchQuery,"onUpdate:modelValue":e[1]||(e[1]=a=>t(s).searchQuery=a),placeholder:"Cari data",style:{"inline-size":"15.625rem"}},null,8,["modelValue"])])]),_:1}),o(B),o(le,{page:t(s).page,"onUpdate:page":e[2]||(e[2]=a=>t(s).page=a),"items-per-page":t(s).itemsPerPage,"items-per-page-options":[{value:10,title:"10"},{value:20,title:"20"},{value:50,title:"50"}],items:t(b),"server-items-length":t(P),"items-length":t(P),headers:N,"items-per-page-text":"Item",options:t(s),loading:t(V),"loading-text":"Loading...","onUpdate:sortBy":$,"header-props":{class:"text-no-wrap"}},{"item.kelas":r(({item:a})=>{var d;return[m(T((d=a.kelas)==null?void 0:d.nama),1)]}),"item.penerima_kip":r(({item:a})=>[o(se,{color:a.penerima_kip==1?"success":"error"},{default:r(()=>[m(T(a.penerima_kip==1?"Ya":"Tidak"),1)]),_:2},1032,["color"])]),"item.berat":r(({item:a})=>[o(u,{modelValue:t(p).berat_badan[a.peserta_didik_id],"onUpdate:modelValue":d=>t(p).berat_badan[a.peserta_didik_id]=d,"error-messages":t(k).berat_badan[a.peserta_didik_id]},null,8,["modelValue","onUpdate:modelValue","error-messages"])]),"item.layak_pip":r(({item:a})=>[o(i,{items:[{title:"Ya",value:"1"},{title:"Tidak",value:"0"}],modelValue:t(p).layak_pip[a.peserta_didik_id],"onUpdate:modelValue":[d=>t(p).layak_pip[a.peserta_didik_id]=d,d=>R(a.peserta_didik_id,d)],"error-messages":t(k).layak_pip[a.peserta_didik_id]},null,8,["modelValue","onUpdate:modelValue","error-messages"])]),"item.id_layak_pip":r(({item:a})=>[o(y,{modelValue:t(p).id_layak_pip[a.peserta_didik_id],"onUpdate:modelValue":d=>t(p).id_layak_pip[a.peserta_didik_id]=d,items:t(w),placeholder:"== Pilih ==","item-title":"alasan_layak_pip","item-value":"id_layak_pip"},null,8,["modelValue","onUpdate:modelValue","items"])]),"item.aksi":r(({item:a})=>[o(ee,{size:"small",onClick:d=>Q(a.peserta_didik_id),disabled:t(c)[a.peserta_didik_id],loading:t(c)[a.peserta_didik_id]},{default:r(()=>e[5]||(e[5]=[m("Simpan")])),_:2,__:[5]},1032,["onClick","disabled","loading"])]),_:1},8,["page","items-per-page","items","server-items-length","items-length","options","loading"])]),_:1})):(f(),x(h,{key:1,color:"#007BB6"},{default:r(()=>[o(A,null,{default:r(()=>[S("p",re,[e[7]||(e[7]=m(" Data Sekolah tidak ditemukan. Silahkan Simpan Data Sekolah terlebih dahulu ")),o(E,{class:"text-success ms-1",to:{name:"root"}},{default:r(()=>e[6]||(e[6]=[m(" disini ")])),_:1,__:[6]})])]),_:1})]),_:1})),o(Y,{modelValue:t(_),"onUpdate:modelValue":e[3]||(e[3]=a=>J(_)?_.value=a:null),color:"success",location:"top end"},{default:r(()=>e[8]||(e[8]=[m(" PIP berhasil disimpan. ")])),_:1,__:[8]},8,["modelValue"])],64))}}};export{Be as default};
