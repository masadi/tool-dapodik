import{_ as F}from"./AppAutocomplete-DoZlIOra.js";import{_ as q}from"./AppTextField-C5NtTJnW.js";import{V as Y,_ as K,a as M}from"./VSnackbar-Zv1JJcyb.js";import{u as U}from"./useApi-obuZURhq.js";import{c as D}from"./VTable-CYQqX1ac.js";import{$ as O}from"./api-YWKl5vSZ.js";import{V as h,a as j,b as G}from"./VCard-R3gxVz52.js";import{E as H,r as n,w as I,f as x,c as J,l,e as o,b as i,a2 as W,F as X,a as Z,o as f,ay as ee,s as u,d as S,a0 as ae,t as T,az as le}from"./main-D5YvgCjt.js";import{V as B}from"./VDivider-CumrEmxb.js";import{V as A}from"./VCardText-TAbZaq51.js";import{V as te}from"./VSpacer-C1xpqeC5.js";import{V as se}from"./VChip-BuoSjUEw.js";import"./VTextField-FnbS8rHt.js";import"./VImg-cwMsIaom.js";import"./forwardRefs-CWJzJQtr.js";import"./VList-DkSMlIoX.js";import"./VAvatar-BOCiSy9V.js";import"./VMenu-DgYIRoKL.js";import"./VDataTable-CRpoNW4o.js";import"./index-CvOPxmL5.js";/* empty css              */const ie={class:"d-flex gap-2 align-center"},oe={class:"d-flex align-center flex-wrap gap-4"},re={class:"clamp-text text-white mb-0"},Ie={__name:"pip",setup(pe){H(async()=>{await L()});const g=n(!1),v=n(),L=async()=>{g.value=!0;try{let e=(await U(D("/cek-sekolah"))).data.value;v.value=e.sekolah,p.value.semester_id=e.semester.semester_id,v.value&&C()}catch(t){console.error(t)}finally{g.value=!1}},N=[{title:"Nama",key:"nama",sortable:!0,nowrap:!0},{title:"NISN",key:"nisn",align:"center"},{title:"Kelas",key:"kelas",align:"center",sortable:!1},{title:"Penerima PIP",key:"penerima_kip",align:"center",sortable:!1},{title:"Layak PIP",key:"layak_pip",align:"center",sortable:!1},{title:"Alasan Layak PIP",key:"id_layak_pip",align:"center",sortable:!1},{title:"aksi",key:"aksi",align:"center",sortable:!1}],s=n({page:1,itemsPerPage:10,searchQuery:"",selectedRole:null,sortby:"nama",sortbydesc:"ASC"}),V=n(!1),b=n([]),P=n(0),w=n([]),$=t=>{var e,r;s.value.sortby=(e=t[0])==null?void 0:e.key,s.value.sortbydesc=(r=t[0])==null?void 0:r.order},p=n({semester_id:null,layak_pip:{},id_layak_pip:{}}),_=n(!1),C=async()=>{V.value=!0;try{let e=(await U(D("/pip",{query:{q:s.value.searchQuery,page:s.value.page,per_page:s.value.itemsPerPage,sortby:s.value.sortby,sortbydesc:s.value.sortbydesc}}))).data.value;b.value=e.data.data,P.value=e.data.total,w.value=e.layak_pip,b.value.forEach(r=>{p.value.layak_pip[r.peserta_didik_id]=r.layak_pip,p.value.id_layak_pip[r.peserta_didik_id]=r.id_layak_pip?parseInt(r.id_layak_pip):null})}catch(t){console.error(t)}finally{V.value=!1}};I(s,le(()=>{C()},500),{deep:!0}),I(()=>s.value.searchQuery,()=>{s.value.page=1});const c=n([]),z=n(),k=n({layak_pip:{},id_layak_pip:{}}),Q=async t=>{z.value=t,c.value[t]=!0,await O("/pip",{method:"POST",body:{peserta_didik_id:t,layak_pip:p.value.layak_pip[t],id_layak_pip:p.value.id_layak_pip[t]},async onResponse({response:e}){var m,y;console.log(p.value.layak_pip[t]);const r=e._data;c.value[t]=!1,k.value.layak_pip[t]=((m=r.errors)==null?void 0:m.layak_pip)??void 0,k.value.id_layak_pip[t]=((y=r.errors)==null?void 0:y.id_layak_pip)??void 0,r.errors||(_.value=!0)}})},R=(t,e)=>{parseInt(e)||(p.value.id_layak_pip[t]=null)};return(t,e)=>{const r=K,m=q,y=F,E=Z("RouterLink");return l(g)?(f(),x(h,{key:0,class:"text-center"},{default:o(()=>[i(ee,{size:60,indeterminate:"",color:"error",class:"my-10"})]),_:1})):(f(),J(X,{key:1},[l(v)?(f(),x(h,{key:0},{default:o(()=>[i(j,{class:"pb-4"},{default:o(()=>[i(G,null,{default:o(()=>e[4]||(e[4]=[u("Data Periodik Siswa")])),_:1,__:[4]})]),_:1}),i(B),i(A,{class:"d-flex flex-wrap gap-4"},{default:o(()=>[S("div",ie,[i(r,{modelValue:l(s).itemsPerPage,"onUpdate:modelValue":e[0]||(e[0]=a=>l(s).itemsPerPage=a),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"}],style:{"inline-size":"15.5rem"}},null,8,["modelValue"])]),i(te),S("div",oe,[i(m,{modelValue:l(s).searchQuery,"onUpdate:modelValue":e[1]||(e[1]=a=>l(s).searchQuery=a),placeholder:"Cari data",style:{"inline-size":"15.625rem"}},null,8,["modelValue"])])]),_:1}),i(B),i(M,{page:l(s).page,"onUpdate:page":e[2]||(e[2]=a=>l(s).page=a),"items-per-page":l(s).itemsPerPage,"items-per-page-options":[{value:10,title:"10"},{value:20,title:"20"},{value:50,title:"50"}],items:l(b),"server-items-length":l(P),"items-length":l(P),headers:N,"items-per-page-text":"Item",options:l(s),loading:l(V),"loading-text":"Loading...","onUpdate:sortBy":$,"header-props":{class:"text-no-wrap"}},{"item.kelas":o(({item:a})=>{var d;return[u(T((d=a.kelas)==null?void 0:d.nama),1)]}),"item.penerima_kip":o(({item:a})=>[i(se,{color:a.penerima_kip==1?"success":"error"},{default:o(()=>[u(T(a.penerima_kip==1?"Ya":"Tidak"),1)]),_:2},1032,["color"])]),"item.berat":o(({item:a})=>[i(m,{modelValue:l(p).berat_badan[a.peserta_didik_id],"onUpdate:modelValue":d=>l(p).berat_badan[a.peserta_didik_id]=d,"error-messages":l(k).berat_badan[a.peserta_didik_id]},null,8,["modelValue","onUpdate:modelValue","error-messages"])]),"item.layak_pip":o(({item:a})=>[i(r,{items:[{title:"Ya",value:"1"},{title:"Tidak",value:"0"}],modelValue:l(p).layak_pip[a.peserta_didik_id],"onUpdate:modelValue":[d=>l(p).layak_pip[a.peserta_didik_id]=d,d=>R(a.peserta_didik_id,d)],"error-messages":l(k).layak_pip[a.peserta_didik_id]},null,8,["modelValue","onUpdate:modelValue","error-messages"])]),"item.id_layak_pip":o(({item:a})=>[i(y,{modelValue:l(p).id_layak_pip[a.peserta_didik_id],"onUpdate:modelValue":d=>l(p).id_layak_pip[a.peserta_didik_id]=d,items:l(w),placeholder:"== Pilih ==","item-title":"alasan_layak_pip","item-value":"id_layak_pip"},null,8,["modelValue","onUpdate:modelValue","items"])]),"item.aksi":o(({item:a})=>[i(ae,{size:"small",onClick:d=>Q(a.peserta_didik_id),disabled:l(c)[a.peserta_didik_id],loading:l(c)[a.peserta_didik_id]},{default:o(()=>e[5]||(e[5]=[u("Simpan")])),_:2,__:[5]},1032,["onClick","disabled","loading"])]),_:1},8,["page","items-per-page","items","server-items-length","items-length","options","loading"])]),_:1})):(f(),x(h,{key:1,color:"#007BB6"},{default:o(()=>[i(A,null,{default:o(()=>[S("p",re,[e[7]||(e[7]=u(" Data Sekolah tidak ditemukan. Silahkan Simpan Data Sekolah terlebih dahulu ")),i(E,{class:"text-success ms-1",to:{name:"root"}},{default:o(()=>e[6]||(e[6]=[u(" disini ")])),_:1,__:[6]})])]),_:1})]),_:1})),i(Y,{modelValue:l(_),"onUpdate:modelValue":e[3]||(e[3]=a=>W(_)?_.value=a:null),color:"success",location:"top end"},{default:o(()=>e[8]||(e[8]=[u(" PIP berhasil disimpan. ")])),_:1,__:[8]},8,["modelValue"])],64))}}};export{Ie as default};
